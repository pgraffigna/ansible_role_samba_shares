---
- name: Incluye el archivo con las variables
  ansible.builtin.include_vars:
    file: vars_main.yml

- name: Instalaci√≥n Samba
  ansible.builtin.apt:
    name: ['samba']
    update_cache: true
    cache_valid_time: 3600

- name: Creando los grupos
  ansible.builtin.group:
    name: "{{ item }}"
    state: present
  with_items: "{{ grupos }}"

- name: "Creando los usuarios para {{ grupos[0] }}"
  ansible.builtin.user:
    name: "{{ item }}"
    create_home: false
    password: '!'
    shell: "/bin/false"
    groups: "{{ grupos[0] }}"
    update_password: on_create
  with_items: "{{ usuarios_sueldos }}"

- name: Creando los usuarios para "{{ grupos[1] }}"
  ansible.builtin.user:
    name: "{{ item }}"
    create_home: false
    password: '!'
    shell: "/bin/false"
    groups: "{{ grupos[1] }}"
    update_password: on_create
  with_items: "{{ usuarios_administracion }}"

- name: Creando los usuarios para "{{ grupos[2] }}"
  ansible.builtin.user:
    name: "{{ item }}"
    create_home: false
    password: '!'
    shell: "/bin/false"
    groups: "{{ grupos[2] }}"
    update_password: on_create
  with_items: "{{ usuarios_sistemas }}"

- name: Configurando el password para acceso a samba de los usuarios
  ansible.builtin.shell: "printf '{{ item.value }}\n{{ item.value }}\n' | smbpasswd -s -a {{ item.key }}"
  with_items: "{{ usuarios_smb | dict2items }}"
